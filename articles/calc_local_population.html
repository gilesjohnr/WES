<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Calculating local population size • WES</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculating local population size">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-HQPXKPQH2C"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-HQPXKPQH2C');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">WES</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><a class="dropdown-item" href="../articles/template_WES_data.html">1. Data templates</a></li>
    <li><a class="dropdown-item" href="../articles/metadata_functions.html">2. Metadata</a></li>
    <li><a class="dropdown-item" href="../articles/derivative_quantities.html">3. qPCR absolute quantification</a></li>
    <li><a class="dropdown-item" href="../articles/derivative_quantities.html">4. qPCR relative quantification</a></li>
    <li><a class="dropdown-item" href="../articles/amplification_efficiency.html">5. qPCR amplification efficiency</a></li>
    <li><a class="dropdown-item" href="../articles/get_climate_data.html">6. Climate data</a></li>
    <li><a class="dropdown-item" href="../articles/calc_hydro_variables.html">7. Hydrological variables</a></li>
    <li><a class="dropdown-item" href="../articles/calc_local_population.html">8. Local population</a></li>
    <li><a class="dropdown-item" href="../articles/get_admin_data.html">9. Administrative boundaries</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gilesjohnr/WES" aria-label="GitHub"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Calculating local population size</h1>
            
      

      <div class="d-none name"><code>calc_local_population.Rmd</code></div>
    </div>

    
    
<p>Determining the size of the local population that contributes to
samples collected at a particular sampling site can be a challenge. When
samples are taken from a sewer or stream network, it is reasonable to
assume that the population residing within the drainage catchment is a
close proxy for the actual contributing population. In settings where
samples are collected from municipal sources, the contributing
population may be harder to identify, especially sampling site is
located in densely populated areas or travel hubs.</p>
<p>To estimate the contributing population for a sampling site, we have
included two methods:</p>
<ol style="list-style-type: decimal">
<li><p>a catchment-based method that delineates the upstream drainage
catchment for each sampling site and sums the population residing within
it, and</p></li>
<li><p>a simple radius method that draws a user-defined radius around
each sampling site and sums the population within it.</p></li>
</ol>
<p>These methods are a good starting point, however, future research
will help to identify the best methods for estimating the local
population contributing to sampling sites. We will add additional
functionality to the package here based on future needs and
research.</p>
<p>See below for an example of how to use the ‘WES’ package to calculate
the local population size for a set of sampling sites using the methods
stated above.</p>
<p><br></p>
<div class="section level3">
<h3 id="download-spatial-data">Download spatial data<a class="anchor" aria-label="anchor" href="#download-spatial-data"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.r-wes.com/">WES</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/edzer/sp/" class="external-link">sp</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster" class="external-link">raster</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggrepel.slowkow.com/" class="external-link">ggrepel</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># Get data frame of simulated environmental sampling data</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>df <span class="ot">&lt;-</span> WES<span class="sc">::</span>template_WES_data</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="fu">head</span>(df)</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>date location_id  lat   lon target_name ct_value</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="dv">1</span> <span class="dv">2020-03-07</span>           <span class="dv">1</span> <span class="fl">23.8</span> <span class="fl">90.37</span>    target_0       <span class="cn">NA</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="dv">2</span> <span class="dv">2020-03-07</span>           <span class="dv">1</span> <span class="fl">23.8</span> <span class="fl">90.37</span>    target_0       <span class="cn">NA</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="dv">3</span> <span class="dv">2020-03-07</span>           <span class="dv">1</span> <span class="fl">23.8</span> <span class="fl">90.37</span>    target_0       <span class="cn">NA</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="dv">4</span> <span class="dv">2020-03-07</span>           <span class="dv">1</span> <span class="fl">23.8</span> <span class="fl">90.37</span>    target_0 <span class="fl">29.95670</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="dv">5</span> <span class="dv">2020-03-07</span>           <span class="dv">1</span> <span class="fl">23.8</span> <span class="fl">90.37</span>    target_1 <span class="fl">31.60111</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="dv">6</span> <span class="dv">2020-03-07</span>           <span class="dv">1</span> <span class="fl">23.8</span> <span class="fl">90.37</span>    target_1 <span class="fl">32.20208</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="co"># Download population raster data from Worldpop</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>WES<span class="sc">::</span><span class="fu">download_worldpop_data</span>(</span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>     <span class="at">iso3 =</span> <span class="st">'BGD'</span>,</span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a>     <span class="at">year =</span> <span class="dv">2020</span>,</span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>     <span class="at">constrained =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a>     <span class="at">UN_adjusted =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a>     <span class="at">path_output =</span> <span class="fu">tempdir</span>()</span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a>)</span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a><span class="co"># Download a DEM for the area surrounding sampling sites</span></span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a>WES<span class="sc">::</span><span class="fu">download_elevation_data</span>(</span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a>     <span class="at">lon =</span> df<span class="sc">$</span>lon,</span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a>     <span class="at">lat =</span> df<span class="sc">$</span>lat,</span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a>     <span class="at">path_output =</span> <span class="fu">tempdir</span>()</span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a>)</span></code></pre></div>
<p>Population and Digital Elevation Model (DEM) are downloaded to the
temp directory.</p>
<p><img src="../reference/figures/dir_download.png" style="width:70.0%"></p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="calculate-local-population">Calculate local population<a class="anchor" aria-label="anchor" href="#calculate-local-population"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># Delineate drainage catchments and calculate the population size within them</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>pop_catchment <span class="ot">&lt;-</span> WES<span class="sc">::</span><span class="fu">get_population_catchment</span>(</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>     <span class="at">lon =</span> df<span class="sc">$</span>lon,</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>     <span class="at">lat =</span> df<span class="sc">$</span>lat,</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>     <span class="at">path_pop_raster =</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">'bgd_ppp_2020.tif'</span>),</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>     <span class="at">path_dem_raster =</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">'dem.tif'</span>),</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>     <span class="at">path_stream_shp =</span> <span class="cn">NULL</span>,</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>     <span class="at">path_output =</span> <span class="fu">tempdir</span>()</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>)</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>pop_catchment</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>lon   lat catchment_area_km2 population_catchment</span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="dv">1</span> <span class="fl">90.37</span> <span class="fl">23.80</span>              <span class="fl">712.2</span>                <span class="dv">69635</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a><span class="dv">2</span> <span class="fl">90.38</span> <span class="fl">23.80</span>               <span class="fl">31.0</span>                 <span class="dv">2834</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="dv">3</span> <span class="fl">90.37</span> <span class="fl">23.81</span>                <span class="fl">5.2</span>                  <span class="dv">279</span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a>pop_radius <span class="ot">&lt;-</span> WES<span class="sc">::</span><span class="fu">get_population_radius</span>(</span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a>     <span class="at">lon =</span> df<span class="sc">$</span>lon,</span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a>     <span class="at">lat =</span> df<span class="sc">$</span>lat,</span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a>     <span class="at">radius =</span> <span class="dv">300</span>,</span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a>     <span class="at">path_pop_raster =</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">'bgd_ppp_2020.tif'</span>),</span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a>     <span class="at">path_output =</span> <span class="fu">tempdir</span>()</span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a>)</span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a></span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a>pop_radius</span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a></span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a>    lon   lat population_radius_300</span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a><span class="dv">1</span> <span class="fl">90.37</span> <span class="fl">23.80</span>                 <span class="dv">62868</span></span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a><span class="dv">2</span> <span class="fl">90.38</span> <span class="fl">23.80</span>                 <span class="dv">38588</span></span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a><span class="dv">3</span> <span class="fl">90.37</span> <span class="fl">23.81</span>                 <span class="dv">21450</span></span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a></span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a><span class="co"># Merge with environmental sampling data</span></span>
<span id="cb3-34"><a href="#cb3-34" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">merge</span>(df, pop_catchment, <span class="at">by=</span><span class="fu">c</span>(<span class="st">'lon'</span>, <span class="st">'lat'</span>), <span class="at">all.x=</span>T)</span>
<span id="cb3-35"><a href="#cb3-35" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">merge</span>(result, pop_radius, <span class="at">by=</span><span class="fu">c</span>(<span class="st">'lon'</span>, <span class="st">'lat'</span>), <span class="at">all.x=</span>T)</span>
<span id="cb3-36"><a href="#cb3-36" tabindex="-1"></a><span class="fu">head</span>(result)</span>
<span id="cb3-37"><a href="#cb3-37" tabindex="-1"></a></span>
<span id="cb3-38"><a href="#cb3-38" tabindex="-1"></a>    lon  lat       date location_id target_name ct_value catchment_area_km2 population_catchment population_radius_300</span>
<span id="cb3-39"><a href="#cb3-39" tabindex="-1"></a><span class="dv">1</span> <span class="fl">90.37</span> <span class="fl">23.8</span> <span class="dv">2020-03-07</span>           <span class="dv">1</span>    target_0       <span class="cn">NA</span>              <span class="fl">712.2</span>                <span class="dv">69635</span>                 <span class="dv">62868</span></span>
<span id="cb3-40"><a href="#cb3-40" tabindex="-1"></a><span class="dv">2</span> <span class="fl">90.37</span> <span class="fl">23.8</span> <span class="dv">2020-03-07</span>           <span class="dv">1</span>    target_0       <span class="cn">NA</span>              <span class="fl">712.2</span>                <span class="dv">69635</span>                 <span class="dv">62868</span></span>
<span id="cb3-41"><a href="#cb3-41" tabindex="-1"></a><span class="dv">3</span> <span class="fl">90.37</span> <span class="fl">23.8</span> <span class="dv">2020-03-07</span>           <span class="dv">1</span>    target_0       <span class="cn">NA</span>              <span class="fl">712.2</span>                <span class="dv">69635</span>                 <span class="dv">62868</span></span>
<span id="cb3-42"><a href="#cb3-42" tabindex="-1"></a><span class="dv">4</span> <span class="fl">90.37</span> <span class="fl">23.8</span> <span class="dv">2020-03-07</span>           <span class="dv">1</span>    target_0 <span class="fl">29.95670</span>              <span class="fl">712.2</span>                <span class="dv">69635</span>                 <span class="dv">62868</span></span>
<span id="cb3-43"><a href="#cb3-43" tabindex="-1"></a><span class="dv">5</span> <span class="fl">90.37</span> <span class="fl">23.8</span> <span class="dv">2020-03-07</span>           <span class="dv">1</span>    target_1 <span class="fl">31.60111</span>              <span class="fl">712.2</span>                <span class="dv">69635</span>                 <span class="dv">62868</span></span>
<span id="cb3-44"><a href="#cb3-44" tabindex="-1"></a><span class="dv">6</span> <span class="fl">90.37</span> <span class="fl">23.8</span> <span class="dv">2020-03-07</span>           <span class="dv">1</span>    target_1 <span class="fl">32.20208</span>              <span class="fl">712.2</span>                <span class="dv">69635</span>                 <span class="dv">62868</span></span></code></pre></div>
<p>The intermediate spatial data produced in the delineation of drainage
catchments and calculation of population size are also saved to the temp
output directory.</p>
<p><img src="../reference/figures/dir_output.png" style="width:70.0%"></p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="plot-results">Plot results<a class="anchor" aria-label="anchor" href="#plot-results"></a>
</h3>
<p>These output data can be used for further analysis and visualization.
Below is an example plot of the local population calculations shown
above.</p>
<div class="sourceCode" id="cb4" eval="FALSE"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pts</span> <span class="op">&lt;-</span> <span class="fu">sp</span><span class="fu">::</span><span class="fu"><a href="https://edzer.github.io/sp/reference/SpatialPoints.html" class="external-link">SpatialPoints</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">pop_catchment</span><span class="op">$</span><span class="va">lon</span>, y<span class="op">=</span><span class="va">pop_catchment</span><span class="op">$</span><span class="va">lat</span><span class="op">)</span>, proj4string<span class="op">=</span><span class="fu">sp</span><span class="fu">::</span><span class="fu"><a href="https://edzer.github.io/sp/reference/CRS-class.html" class="external-link">CRS</a></span><span class="op">(</span><span class="st">"+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rast_dem</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html" class="external-link">raster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">'dem.tif'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rast_pop</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html" class="external-link">raster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">'bgd_ppp_2020_crop.tif'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">shp_streams</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">'streams.shp'</span><span class="op">)</span>, quiet<span class="op">=</span><span class="cn">TRUE</span>, crs <span class="op">=</span> <span class="st">"+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"</span><span class="op">)</span></span>
<span><span class="va">shp_catchments</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">'catchments.shp'</span><span class="op">)</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">shp_radius</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">'points_buffer_300.shp'</span><span class="op">)</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">rast_dem</span>, xy<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'dem'</span></span>
<span></span>
<span><span class="va">plot_catchment</span> <span class="op">&lt;-</span></span>
<span>     <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_raster</span><span class="op">(</span>data<span class="op">=</span><span class="va">tmp</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span>, fill<span class="op">=</span><span class="va">dem</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_sf</span><span class="op">(</span>data<span class="op">=</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">shp_streams</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"dodgerblue"</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_sf</span><span class="op">(</span>data<span class="op">=</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">shp_catchments</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"green"</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_point</span><span class="op">(</span>data<span class="op">=</span><span class="va">pop_catchment</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">lon</span>, y<span class="op">=</span><span class="va">lat</span><span class="op">)</span>, pch<span class="op">=</span><span class="fl">3</span>, size<span class="op">=</span><span class="fl">2</span>, color<span class="op">=</span><span class="st">'red'</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">ggrepel</span><span class="fu">::</span><span class="fu">geom_label_repel</span><span class="op">(</span>data<span class="op">=</span><span class="va">pop_catchment</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">lon</span>, y<span class="op">=</span><span class="va">lat</span>, label<span class="op">=</span><span class="va">catchment_area_km2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">ggtitle</span><span class="op">(</span><span class="st">'Catchment size (sq km)'</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">ggrepel</span><span class="fu">::</span><span class="fu">geom_label_repel</span><span class="op">(</span>box.padding   <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                               point.padding <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                               segment.color <span class="op">=</span> <span class="st">'black'</span>,</span>
<span>                               segment.size <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">scale_fill_gradient</span><span class="op">(</span>low<span class="op">=</span><span class="st">"black"</span>, high<span class="op">=</span><span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">coord_sf</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>           legend.position<span class="op">=</span><span class="st">'right'</span>,</span>
<span>           legend.title <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>           legend.key.height<span class="op">=</span><span class="fu">unit</span><span class="op">(</span><span class="fl">40</span>,<span class="st">'pt'</span><span class="op">)</span>,</span>
<span>           legend.key.width<span class="op">=</span><span class="fu">unit</span><span class="op">(</span><span class="fl">5</span>,<span class="st">'pt'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">rast_pop</span>, xy<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'pop'</span></span>
<span></span>
<span><span class="va">plot_catchment_pop</span> <span class="op">&lt;-</span></span>
<span>     <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_raster</span><span class="op">(</span>data<span class="op">=</span><span class="va">tmp</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span>, fill<span class="op">=</span><span class="va">pop</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_sf</span><span class="op">(</span>data<span class="op">=</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">shp_catchments</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"green"</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_point</span><span class="op">(</span>data<span class="op">=</span><span class="va">pop_catchment</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">lon</span>, y<span class="op">=</span><span class="va">lat</span><span class="op">)</span>, pch<span class="op">=</span><span class="fl">3</span>, size<span class="op">=</span><span class="fl">2</span>, color<span class="op">=</span><span class="st">'red'</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">ggrepel</span><span class="fu">::</span><span class="fu">geom_label_repel</span><span class="op">(</span>data<span class="op">=</span><span class="va">pop_catchment</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">lon</span>, y<span class="op">=</span><span class="va">lat</span>, label<span class="op">=</span><span class="va">population_catchment</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">ggtitle</span><span class="op">(</span><span class="st">'Population within catchment'</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">ggrepel</span><span class="fu">::</span><span class="fu">geom_label_repel</span><span class="op">(</span>box.padding   <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                               point.padding <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                               segment.color <span class="op">=</span> <span class="st">'black'</span>,</span>
<span>                               segment.size <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">scale_fill_viridis_c</span><span class="op">(</span>na.value<span class="op">=</span><span class="st">'white'</span>, option<span class="op">=</span><span class="st">'rocket'</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">coord_sf</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>           legend.position<span class="op">=</span><span class="st">'right'</span>,</span>
<span>           legend.title <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>           legend.key.height<span class="op">=</span><span class="fu">unit</span><span class="op">(</span><span class="fl">40</span>,<span class="st">'pt'</span><span class="op">)</span>,</span>
<span>           legend.key.width<span class="op">=</span><span class="fu">unit</span><span class="op">(</span><span class="fl">5</span>,<span class="st">'pt'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">rast_pop</span>, xy<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'pop'</span></span>
<span></span>
<span><span class="va">plot_radius_pop</span> <span class="op">&lt;-</span></span>
<span>     <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_raster</span><span class="op">(</span>data<span class="op">=</span><span class="va">tmp</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span>, fill<span class="op">=</span><span class="va">pop</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_sf</span><span class="op">(</span>data<span class="op">=</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">shp_radius</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"green"</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_point</span><span class="op">(</span>data<span class="op">=</span><span class="va">pop_catchment</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">lon</span>, y<span class="op">=</span><span class="va">lat</span><span class="op">)</span>, pch<span class="op">=</span><span class="fl">3</span>, size<span class="op">=</span><span class="fl">2</span>, color<span class="op">=</span><span class="st">'red'</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">ggrepel</span><span class="fu">::</span><span class="fu">geom_label_repel</span><span class="op">(</span>data<span class="op">=</span><span class="va">pop_radius</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">lon</span>, y<span class="op">=</span><span class="va">lat</span>, label<span class="op">=</span><span class="va">population_radius_300</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">ggtitle</span><span class="op">(</span><span class="st">'Population within radius (300m)'</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">ggrepel</span><span class="fu">::</span><span class="fu">geom_label_repel</span><span class="op">(</span>box.padding   <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                               point.padding <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                               segment.color <span class="op">=</span> <span class="st">'black'</span>,</span>
<span>                               segment.size <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">scale_fill_viridis_c</span><span class="op">(</span>na.value<span class="op">=</span><span class="st">'white'</span>, option<span class="op">=</span><span class="st">'rocket'</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">coord_sf</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>           legend.position<span class="op">=</span><span class="st">'right'</span>,</span>
<span>           legend.title <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>           legend.key.height<span class="op">=</span><span class="fu">unit</span><span class="op">(</span><span class="fl">40</span>,<span class="st">'pt'</span><span class="op">)</span>,</span>
<span>           legend.key.width<span class="op">=</span><span class="fu">unit</span><span class="op">(</span><span class="fl">5</span>,<span class="st">'pt'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu">grid.arrange</span><span class="op">(</span><span class="va">plot_catchment</span>, <span class="va">plot_catchment_pop</span>, <span class="va">plot_radius_pop</span>, ncol<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/map_output.png" style="width:160.0%"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by John R Giles.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
